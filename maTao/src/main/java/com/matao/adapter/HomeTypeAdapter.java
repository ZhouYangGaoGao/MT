package com.matao.adapter;import java.util.List;import android.app.Activity;import android.content.Context;import android.content.Intent;import android.view.View;import android.view.View.OnClickListener;import android.view.ViewGroup;import android.view.animation.Animation;import android.view.animation.AnimationUtils;import android.widget.BaseAdapter;import android.widget.GridView;import android.widget.ImageView;import android.widget.RelativeLayout;import android.widget.TextView;import com.matao.activity.DetailsActivity;import com.matao.bean.ArticleList;import com.matao.matao.R;import com.matao.utils.MTApplication;import com.matao.utils.MTUtils;import com.matao.view.RoundAngleImageView;/** * @author: ZhouYang * @E-mail: ZhouYangGaoGao@163.com * @time:2015-5-5 下午5:50:07 * @Description:首页混合列表适配器 */public class HomeTypeAdapter extends BaseAdapter {	private Context context;	private List<ArticleList> list;	private ArticleList art;	// private OnClickListener this;	// private String url;	/**	 * context 上下文对象 list 所需列表内容实例集合	 */	public HomeTypeAdapter(Context context, List<ArticleList> list) {		this.context = context;		this.list = list;	}	@Override	public int getCount() {		return list.size();	}	@Override	public int getItemViewType(int p) {// 列表中一共三种子布局		art = list.get(p);		// this = new onClic(art, DetailsActivity.class);		// reply = new onClic(art, ReplyActivity.class);		// ta = new onClic(art, TaHouseActivity.class);		if (art.getType() == 1) {			return 1;		} else if (art.getType() == 2) {			return 2;		} else {			return 3;		}	}	@Override	public int getViewTypeCount() {		return 4;	}	@Override	public Object getItem(int i) {		return list.get(i);	}	@Override	public long getItemId(int i) {		return i;	}	@Override	public View getView(int p, View cv, ViewGroup g) {		ViewHolder1 vh1 = null;		ViewHolder2 vh2 = null;		ViewHolder3 vh3 = null;		final ArticleList art = list.get(p);		int type = getItemViewType(p);		if (cv == null) {			switch (type) {			case 1:// 初始化海淘优惠				vh1 = new ViewHolder1();				cv = View.inflate(context,						R.layout.item_favorable_and_seas_item, null);				vh1.clicTop = (RelativeLayout) cv						.findViewById(R.id.item_favorable_clik);				vh1.title = (TextView) cv						.findViewById(R.id.favorable_item_title);				vh1.img = (RoundAngleImageView) cv						.findViewById(R.id.favorable_item_icon);				vh1.sTitle = (TextView) cv						.findViewById(R.id.favorable_item_dsc);				vh1.time = (TextView) cv.findViewById(R.id.favorable_item_time);				vh1.like = (TextView) cv.findViewById(R.id.favorable_item_like);				vh1.reply = (TextView) cv						.findViewById(R.id.favorable_item_replys);				vh1.source = (TextView) cv						.findViewById(R.id.favorable_item_source);				vh1.haitao = (TextView) cv						.findViewById(R.id.favorable_item_type);				vh1.outDate = (ImageView) cv						.findViewById(R.id.favorable_item_outDate);				cv.setTag(vh1);				break;			case 2:// 初始化经验item				vh2 = new ViewHolder2();				cv = View.inflate(context, R.layout.item_experience, null);				vh2.title = (TextView) cv						.findViewById(R.id.experience_item_title);				vh2.imgs = (GridView) cv						.findViewById(R.id.experience_item_grid);				vh2.imgCount = (TextView) cv						.findViewById(R.id.experience_item_picCount);				vh2.time = (TextView) cv						.findViewById(R.id.experience_item_time);				vh2.like = (TextView) cv						.findViewById(R.id.experience_item_good);				vh2.reply = (TextView) cv						.findViewById(R.id.experience_item_reply);				vh2.nickName = (TextView) cv						.findViewById(R.id.experience_item_nickName);				vh2.babyAge = (TextView) cv						.findViewById(R.id.experience_item_age);				vh2.icon = (RoundAngleImageView) cv						.findViewById(R.id.experience_item_icon);				vh2.sex = (ImageView) cv.findViewById(R.id.experience_item_sex);				vh2.clicTop = (RelativeLayout) cv						.findViewById(R.id.item_experience_click);				vh2.pick = (ImageView) cv						.findViewById(R.id.experience_item_pick);				cv.setTag(vh2);				break;			case 3:// 初始化晒单item				vh3 = new ViewHolder3();				cv = View.inflate(context, R.layout.item_show, null);				vh3.img = (ImageView) cv.findViewById(R.id.show_item_pic1);				vh3.imgCount = (TextView) cv						.findViewById(R.id.show_item_picCount);				vh3.clicTop = (RelativeLayout) cv						.findViewById(R.id.item_show_click);				vh3.title = (TextView) cv.findViewById(R.id.show_item_title);				vh3.sTitle = (TextView) cv.findViewById(R.id.show_item_dsc);				vh3.time = (TextView) cv.findViewById(R.id.show_item_time);				vh3.like = (TextView) cv.findViewById(R.id.show_item_good);				vh3.reply = (TextView) cv.findViewById(R.id.show_item_reply);				vh3.nickName = (TextView) cv						.findViewById(R.id.show_item_nickName);				vh3.babyAge = (TextView) cv.findViewById(R.id.show_item_age);				vh3.icon = (RoundAngleImageView) cv						.findViewById(R.id.show_item_icon);				vh3.sex = (ImageView) cv.findViewById(R.id.show_item_sex);				vh3.pick = (ImageView) cv.findViewById(R.id.show_item_pick);				cv.setTag(vh3);				break;			}		} else {			switch (type) {// 复用convertView			case 1:				vh1 = (ViewHolder1) cv.getTag();				break;			case 2:				vh2 = (ViewHolder2) cv.getTag();				break;			case 3:				vh3 = (ViewHolder3) cv.getTag();				break;			}		}		switch (type) {		case 1:// 优惠海淘填充数据			MTApplication.bmu.display(vh1.img, art.getImgUrl(),					MTUtils.getConfig(context, R.drawable.matao_220));			vh1.sTitle.setText(art.getSubTitle());			vh1.time.setText(art.getAddDate());			vh1.like.setText(art.getRecommends() + "%");			vh1.reply.setText("" + art.getReplys());			vh1.source.setText("来源：" + art.getSource());			if (art.isIsHaitao()) {				vh1.haitao.setVisibility(View.VISIBLE);				vh1.title.setText("           " + art.getTitle());			} else {				vh1.haitao.setVisibility(View.GONE);				vh1.title.setText(art.getTitle());			}			if (art.isIsExpire()) {				vh1.outDate.setVisibility(View.VISIBLE);				vh1.title.setTextColor(0xffababab);				vh1.sTitle.setTextColor(0xffababab);				vh1.time.setTextColor(0xffababab);				vh1.like.setTextColor(0xffababab);				vh1.reply.setTextColor(0xffababab);				vh1.source.setTextColor(0xffababab);			} else {				vh1.outDate.setVisibility(View.GONE);				vh1.title.setTextColor(0xff444444);				vh1.sTitle.setTextColor(0xfffe6ab4);				vh1.time.setTextColor(0xff999999);				vh1.like.setTextColor(0xff999999);				vh1.reply.setTextColor(0xff999999);				vh1.source.setTextColor(0xff999999);			}			// 点击事件			// vh1.clicTop.setOnClickListener(this);			// cv.findViewById(R.id.favorable_item_good_click).setOnClickListener(			// this);			// cv.findViewById(R.id.favorable_item_replys_click)			// .setOnClickListener(this);			break;		case 2:// 经验填充数据			MTApplication.bmu.display(vh2.icon, art.getAvatar());			vh2.title.setText(art.getTitle());			vh2.nickName.setText("" + art.getUserName());			vh2.time.setText(art.getAddDate());			vh2.like.setText("" + art.getLikes());			vh2.reply.setText("" + art.getReplys());			if (art.isIsPick()) {				vh2.title.setText("     " + art.getTitle());				vh2.pick.setVisibility(View.VISIBLE);			} else {				vh2.title.setText(art.getTitle());				vh2.pick.setVisibility(View.GONE);			}			if (MTUtils.isEmpty(art.getBabyNickName())) {				vh2.babyAge.setText(art.getBabyInfo());			} else {				vh2.babyAge.setText(art.getBabyNickName() + ","						+ art.getBabyInfo());			}			switch (art.getBabyGender()) {			case 0:				vh2.sex.setVisibility(View.VISIBLE);				vh2.sex.setImageResource(R.drawable.ico_male);				break;			case 1:				vh2.sex.setVisibility(View.VISIBLE);				vh2.sex.setImageResource(R.drawable.ico_female);				break;			case 2:				vh2.sex.setVisibility(View.INVISIBLE);				break;			}			String[] img3 = new String[3];			if (art.getImgNum() > 3) {				vh2.imgCount.setVisibility(View.VISIBLE);				vh2.imgs.setVisibility(View.VISIBLE);				vh2.imgCount.setText("共" + art.getImgNum() + "张");				for (int j = 0; j < art.getImgList().length; j++) {					img3[j] = art.getImgList()[j];				}			} else if (art.getImgList() == null || art.getImgList().length == 0) {				vh2.imgs.setVisibility(View.GONE);				vh2.imgCount.setVisibility(View.GONE);			} else {				img3 = art.getImgList();				vh2.imgCount.setVisibility(View.GONE);				vh2.imgs.setVisibility(View.VISIBLE);			}			vh2.imgs.setAdapter(new ExperienceGridAdapter(context, img3, 60));			vh2.imgs.setClickable(false);			vh2.imgs.setPressed(false);			vh2.imgs.setEnabled(false);			// vh2.imgs.setOnItemClickListener(new OnItemClickListener() {			//			// @Override			// public void onItemClick(AdapterView<?> arg0, View arg1,			// int arg2, long arg3) {			// Intent intent = new Intent(context, DetailsActivity.class);			// intent.putExtra("url", art.getUrl());			// context.startActivity(intent);			// }			// });			// vh2.clicTop.setOnClickListener(this);			// cv.findViewById(R.id.ex_ta_click).setOnClickListener(ta);			// cv.findViewById(R.id.experiense_item_good_click)			// .setOnClickListener(this);			// cv.findViewById(R.id.experiense_item_reply_click)			// .setOnClickListener(this);			break;		case 3:// 晒单填充数据			MTApplication.bmu.display(vh3.icon, art.getAvatar());			RelativeLayout.LayoutParams lp = (android.widget.RelativeLayout.LayoutParams) vh3.img					.getLayoutParams();			lp.width = MTUtils.getScreenWidth(context) - 24;			lp.height = (int) (lp.width * 0.5685);			vh3.img.setLayoutParams(lp);			MTApplication.bmu.display(vh3.img, art.getImgUrl(),					MTUtils.getConfig(context, R.drawable.maotao_675_382));			vh3.title.setText(art.getTitle());			vh3.nickName.setText(art.getUserName());			vh3.time.setText(art.getAddDate());			vh3.like.setText("" + art.getLikes());			vh3.reply.setText("" + art.getReplys());			if (art.getImgNum() > 1) {				vh3.imgCount.setVisibility(View.VISIBLE);				vh3.imgCount.setText("" + art.getImgNum());			} else {				vh3.imgCount.setVisibility(View.GONE);			}			if (art.isIsPick()) {				vh3.title.setText("     " + art.getTitle());				vh3.pick.setVisibility(View.VISIBLE);			} else {				vh3.title.setText(art.getTitle());				vh3.pick.setVisibility(View.GONE);			}			if (MTUtils.isEmpty(art.getSummary())) {				vh3.sTitle.setVisibility(View.GONE);			} else {				vh3.sTitle.setVisibility(View.VISIBLE);				vh3.sTitle.setText(art.getSummary());			}			if (MTUtils.isEmpty(art.getBabyNickName())) {				vh3.babyAge.setText(art.getBabyInfo());			} else {				vh3.babyAge.setText(art.getBabyNickName() + ","						+ art.getBabyInfo());			}			// 根据宝宝性别更换图标			switch (art.getBabyGender()) {			case 0:				vh3.sex.setVisibility(View.VISIBLE);				vh3.sex.setImageResource(R.drawable.ico_male);				break;			case 1:				vh3.sex.setVisibility(View.VISIBLE);				vh3.sex.setImageResource(R.drawable.ico_female);				break;			case 2:				vh3.sex.setVisibility(View.INVISIBLE);				break;			}			// vh3.clicTop.setOnClickListener(this);			// cv.findViewById(R.id.show_ta_click).setOnClickListener(ta);			// cv.findViewById(R.id.show_item_good_click).setOnClickListener(this);			// cv.findViewById(R.id.show_item_reply_click).setOnClickListener(this);			break;		}		cv.setOnClickListener(new OnClickListener() {			@Override			public void onClick(View v) {				Intent i = new Intent(context, DetailsActivity.class);				i.putExtra("url", art.getUrl());				context.startActivity(i);				((Activity) context).overridePendingTransition(						R.anim.slide_left_in, R.anim.slide_left_out);			}		});		if (isAnimtion && p > lastPosition) {// 这里就是动画的应用			Animation animation = AnimationUtils.loadAnimation(context,					(p > lastPosition) ? R.anim.slide_bottom_to_top							: R.anim.slide_top_to_bottom);			cv.startAnimation(animation);		}		if (p == list.size() - 1) {			isAnimtion = false;		}		if (!isAnimtion && (p % 20 == 0 || p % 20 == 10)) {			isAnimtion = true;		}		lastPosition = p;		return cv;	}	public boolean isAnimtion = true;	int lastPosition = 0;	class ViewHolder1 {		RoundAngleImageView img;		RelativeLayout clicTop;		TextView title;		TextView sTitle;		ImageView icoTime;		ImageView icoLike;		ImageView icoReply;		TextView time;		TextView like;		TextView reply;		ImageView outDate;		TextView haitao;		TextView source;	}	class ViewHolder2 {		TextView title;		ImageView icoTime;		RelativeLayout clicTop;		ImageView icoLike;		ImageView icoReply;		TextView time;		TextView like;		TextView reply;		TextView imgCount;		GridView imgs;		TextView nickName;		TextView babyAge;		RoundAngleImageView icon;		ImageView sex;		ImageView pick;	}	class ViewHolder3 {		TextView title;		TextView sTitle;		RelativeLayout clicTop;		ImageView icoTime;		ImageView icoLike;		ImageView icoReply;		TextView time;		TextView like;		TextView reply;		TextView nickName;		TextView babyAge;		RoundAngleImageView icon;		ImageView sex;		ImageView pick;		ImageView img;		TextView imgCount;	}	/**	 * 封装点击事件 传入 文章id和药跳转的界面	 * 	 * @author: ZhouYang	 * @time:2015-5-13 上午11:59:13	 * @Description:跳转 传值	 */	// class onClic implements OnClickListener {	// private Class<?> cls;	// private ArticleList art;	//	// public onClic(ArticleList art, Class<?> cls) {	// this.cls = cls;	// this.art = art;	// }	//	// @Override	// public void onClick(View v) {	// Intent intent = new Intent(context, cls);	// intent.putExtra("url", art.getUrl());	// intent.putExtra("OwnerUserId", art.getUserId());	// intent.putExtra("ArticleId", art.getId());	// intent.putExtra("type", art.getType());	// context.startActivity(intent);	// ((Activity) context).overridePendingTransition(	// R.anim.slide_left_in, R.anim.slide_left_out);	// }	// }}